<!DOCTYPE html>
<html>
	<head>
		<title>åŸç”Ÿ HTML åŠ¨æ€è¡¨æ ¼ - åŒ…å«åˆè®¡è¡Œ</title>
	</head>
	<body>
		<h2>AGV åŠ¨æ€æ•°æ®è¡¨</h2>
		<table id="data-table">
			<thead>
				<tr>
					<th>åˆ— 1 (æ±‚å’Œ)</th>
					<th>åˆ— 2 (æ±‚å’Œ)</th>
					<th>åˆ— 3 (æ±‚å’Œ)</th>
					<th>åˆ— 4 (æ±‚å’Œ)</th>
					<th>åˆ— 5 (æ±‚å’Œ)</th>
					<th>åˆ— 6 (æ±‚å’Œ)</th>
					<th>åˆ— 7 (æ±‚å’Œ)</th>
					<th>åˆ— 8 (æ±‚å’Œ)</th>
				</tr>
			</thead>

			<tbody id="data-table-body">
				<tr>
					<td>42</td>
					<td>
						<input type="text" value="åˆå§‹æ–‡æœ¬" oninput="updateTotals()" />
					</td>
					<td>15</td>
					<td></td>
					<td>45</td>
					<td>55</td>
					<td>65</td>
					<td>75</td>
				</tr>
			</tbody>

			<tfoot>
				<tr id="total-row">
					<td id="total-col-0">0</td>
					<td id="total-col-1">0</td>
					<td id="total-col-2">0</td>
					<td id="total-col-3">0</td>
					<td id="total-col-4">0</td>
					<td id="total-col-5">0</td>
					<td id="total-col-6">0</td>
					<td id="total-col-7">0</td>
				</tr>
			</tfoot>
		</table>
		<button onclick="addRow()">æ·»åŠ æ–°çš„è¡¨æ ¼è¡Œ</button>
		<button onclick="deleteRow()">åˆ é™¤æœ€åä¸€è¡Œæ•°æ®</button>
		<button onclick="calculateColumnFour()">è®¡ç®— (æ›´æ–°ç¬¬å››åˆ—)</button>
		<script>
			const NUM_COLUMNS = 8;
			function getRandomFloat(min, max, decimals = 2) {
				const str = (Math.random() * (max - min) + min).toFixed(decimals);
				return parseFloat(str);
			}
			function addRow() {
				const tableBody = document.getElementById("data-table-body");
				const newRow = document.createElement("tr");

				for (let i = 0; i < NUM_COLUMNS; i++) {
					if (i === 1) {
						const inputCell = document.createElement("input");
						inputCell.type = "text";
						inputCell.placeholder = "è¾“å…¥æ–‡æœ¬";
						newRow.appendChild(inputCell);
					} 
                    /*
                    else if (i === 3) {
						const nodataCell = document.createElement("td");
						nodataCell.textContent = "";
						newRow.appendChild(nodataCell);
					}
                    */
                    else {
						const randomNumber = getRandomFloat(10, 100, 2);
						const newCell = document.createElement("td");
						newCell.textContent = randomNumber;
					}
				}
				tableBody.appendChild(newRow);

				// ** å…³é”®æ­¥éª¤ï¼šæ·»åŠ æ–°è¡Œåï¼Œç«‹å³æ›´æ–°åˆè®¡è¡Œ **
				updateTotals();
			}
			function deleteRow() {
				const tableBody = document.getElementById("data-table-body");
				const dataRows = tableBody.getElementsByTagName("tr");

				// æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®è¡Œå¯ä»¥åˆ é™¤ (ç¡®ä¿è‡³å°‘ä¿ç•™ä¸€è¡Œ)
				if (dataRows.length > 1) {
					// è·å– tbody ä¸­çš„æœ€åä¸€è¡Œ
					const lastRow = dataRows[dataRows.length - 1];

					// ä» tbody ä¸­ç§»é™¤è¿™ä¸€è¡Œ
					tableBody.removeChild(lastRow);

					// åˆ é™¤è¡Œåï¼Œæ›´æ–°åˆè®¡è¡Œ
					updateTotals();
				} else if (dataRows.length === 1) {
					// ä»…å‰©ä¸€è¡Œæ—¶ï¼Œç»™å‡ºæç¤ºæˆ–æ‰§è¡Œæ¸…ç©ºæ“ä½œ
					alert("å·²æ˜¯æœ€åä¸€è¡Œæ•°æ®ï¼Œä¸èƒ½å†åˆ é™¤ã€‚");
				} else {
					// è¡¨æ ¼å·²ç©º
					alert("è¡¨æ ¼ä¸»ä½“å·²æ— æ•°æ®è¡Œå¯åˆ é™¤ã€‚");
				}
			}
			function updateTotals() {
				const tableBody = document.getElementById("data-table-body");
				// åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„æ¥å­˜å‚¨æ¯åˆ—çš„æ€»å’Œ
				const sums = new Array(NUM_COLUMNS).fill(0);

				// éå† tbody ä¸­çš„æ‰€æœ‰è¡Œ
				const dataRows = tableBody.getElementsByTagName("tr");

				for (let i = 0; i < dataRows.length; i++) {
					const cells = dataRows[i].getElementsByTagName("td");

					for (let j = 0; j < cells.length && j < NUM_COLUMNS; j++) {
						// **ã€æ ¸å¿ƒé€»è¾‘ã€‘è·³è¿‡ç¬¬ 2 åˆ— (j=1) çš„æ±‚å’Œ**
						if (j === 1 || j === 3) {
							continue; // è·³è¿‡å½“å‰åˆ—ï¼Œç»§ç»­ä¸‹ä¸€åˆ—
						}

						let value;
						const cellContent = cells[j].textContent.trim();

						// ğŸ’¡ å¤„ç†è¾“å…¥æ¡†çš„å€¼ï¼šå¦‚æœå•å…ƒæ ¼å†…æœ‰ inputï¼Œæå– input çš„å€¼
						const inputElement = cells[j].querySelector("input");

						if (inputElement) {
							// å¦‚æœæ˜¯è¾“å…¥æ¡†åˆ—ï¼ˆè™½ç„¶æˆ‘ä»¬ä¸Šé¢è·³è¿‡äº†ï¼Œä½†ä»¥é˜²ä¸‡ä¸€ï¼‰ï¼Œæˆ–è€…å…¶ä»–æ•°å­—åˆ—æœªæ¥ä¹Ÿç”¨è¾“å…¥æ¡†
							value = parseFloat(inputElement.value.trim());
						} else {
							// å¦‚æœæ˜¯æ ‡å‡† <td> å•å…ƒæ ¼ï¼Œæå–å…¶æ–‡æœ¬å†…å®¹
							value = parseFloat(cellContent);
						}

						if (!isNaN(value)) {
							// ä½¿ç”¨ Math.round() é¿å…ä¸­é—´è®¡ç®—çš„ç²¾åº¦è¯¯å·®
							const factor = 10000; // æé«˜ç²¾åº¦åˆ°ä¸‡åˆ†ä¹‹ä¸€
							sums[j] = Math.round((sums[j] + value) * factor) / factor;
						}
					}
				}

				/* å°†è®¡ç®—å‡ºçš„æ€»å’Œæ›´æ–°åˆ°é¡µè„š (tfoot)
				for (let k = 0; k < NUM_COLUMNS; k++) {
					const totalCell = document.getElementById(`total-col-${k}`);
					const finalSum = sums[k].toFixed(2);
					if (totalCell) {
						totalCell.textContent = finalSum;
					}
				}
                */
			}
			function calculateColumnFour() {
				const tableBody = document.getElementById("data-table-body");
				const dataRows = tableBody.getElementsByTagName("tr");

				// ç²¾åº¦å› å­ï¼Œç”¨äºé¿å…æµ®ç‚¹æ•°è¯¯å·®ï¼ˆä¾‹å¦‚ä¿ç•™ä¸¤ä½å°æ•°ï¼Œå°±ä½¿ç”¨ 100ï¼‰
				const factor = 100;

				for (let i = 0; i < dataRows.length; i++) {
					const cells = dataRows[i].getElementsByTagName("td");

					// 1. æå–ç¬¬ä¸€åˆ— (ç´¢å¼• 0) çš„å€¼
					// ä½¿ç”¨ || 0 ç¡®ä¿å¦‚æœå†…å®¹ä¸ºç©ºï¼Œåˆ™è§£æä¸º 0
					const val1 = parseFloat(cells[0].textContent.trim() || 0);

					// 2. æå–ç¬¬ä¸‰åˆ— (ç´¢å¼• 2) çš„å€¼
					const val3 = parseFloat(cells[2].textContent.trim() || 0);

					// 3. è®¡ç®—æ€»å’Œå¹¶å¤„ç†ç²¾åº¦è¯¯å·® (ä¹˜ 100 å››èˆäº”å…¥ï¼Œå†é™¤ 100)
					const rawSum = val1 + val3;
					const result = Math.round(rawSum * factor) / factor;

					// 4. æ›´æ–°ç¬¬å››åˆ— (ç´¢å¼• 3) çš„å†…å®¹
					if (cells.length > 3) {
						// ä½¿ç”¨ toFixed(2) æ ¼å¼åŒ–ç»“æœï¼Œç¡®ä¿æ˜¾ç¤ºä¸¤ä½å°æ•°
						cells[3].textContent = result.toFixed(2);
					}
				}

				// ğŸ’¡ æç¤ºï¼šç”±äºç¬¬å››åˆ—å†…å®¹å‘ç”Ÿäº†å˜åŒ–ï¼Œåº”è¯¥é‡æ–°è®¡ç®—è¡¨æ ¼åº•éƒ¨çš„åˆè®¡è¡Œ
				updateTotals();
			}
			window.onload = updateTotals;
		</script>
	</body>
</html>
